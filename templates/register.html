<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Register Your Store</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-50 to-emerald-50">

  <!-- Top brand bar -->
  <header class="bg-white/90 backdrop-blur border-b sticky top-0 z-40">
    <div class="max-w-3xl mx-auto px-4 py-4 flex items-center justify-between">
      <a href="/" class="flex items-center gap-2 text-emerald-600 font-extrabold tracking-tight text-xl">
        <i class="fa-solid fa-qrcode"></i> SmartDukaan
      </a>
      <nav class="hidden sm:flex items-center gap-3">
        <a href="/" class="text-gray-700 hover:text-emerald-600 text-sm font-medium">Home</a>
        <a href="/login" class="text-sm font-semibold bg-yellow-400 hover:bg-yellow-500 text-black px-4 py-2 rounded-lg shadow">
          Seller Login
        </a>
      </nav>
    </div>
  </header>

  <!-- Page -->
  <main class="max-w-3xl mx-auto px-4 py-8">
    <div class="bg-white rounded-3xl shadow-xl border border-gray-100 p-6 sm:p-8">

      <!-- Heading -->
      <div class="text-center mb-8">
        <h1 class="text-2xl sm:text-3xl font-extrabold text-gray-900">Register Your Store</h1>
        <p class="text-gray-500 mt-1">Create your SmartDukaan seller account in a minute üöÄ</p>
      </div>

      <!-- Progress -->
      <div class="flex flex-wrap items-center justify-center gap-2 mb-8">
        <span class="px-3 py-1 rounded-full border text-xs border-emerald-200 text-emerald-700 bg-emerald-50">1. Store</span>
        <span class="px-3 py-1 rounded-full border text-xs border-emerald-200 text-emerald-700 bg-emerald-50">2. Phone & OTP</span>
        <span class="px-3 py-1 rounded-full border text-xs border-gray-200 text-gray-600">3. Address & Category</span>
        <span class="px-3 py-1 rounded-full border text-xs border-gray-200 text-gray-600">4. Password</span>
      </div>

      <!-- FORM -->
      <form id="registrationForm" action="/register" method="POST" onsubmit="return checkFormValidation()" class="space-y-7">

        <!-- Store + Owner -->
        <div class="grid sm:grid-cols-2 gap-4">
          <div>
            <label for="store_name" class="flex items-center gap-2 text-sm font-semibold text-gray-800 mb-1">
              <i class="fa-solid fa-store text-emerald-600"></i> Store Name
            </label>
            <input
              type="text" id="store_name" name="store_name" required
              placeholder="e.g., Shree Ganesh Kirana"
              class="w-full rounded-xl border border-gray-200 px-4 py-3 focus:ring-2 focus:ring-emerald-400 outline-none"
            />
            <p class="text-xs text-gray-500 mt-1">Enter the official name of your shop.</p>
          </div>

          <div>
            <label for="owner_name" class="flex items-center gap-2 text-sm font-semibold text-gray-800 mb-1">
              <i class="fa-solid fa-user text-emerald-600"></i> Owner Name
            </label>
            <input
              type="text" id="owner_name" name="owner_name" required
              placeholder="Your full name"
              class="w-full rounded-xl border border-gray-200 px-4 py-3 focus:ring-2 focus:ring-emerald-400 outline-none"
            />
            <p class="text-xs text-gray-500 mt-1">Who will manage this seller account.</p>
          </div>
        </div>

        <!-- Phone -->
        <div>
          <label for="phone" class="flex items-center gap-2 text-sm font-semibold text-gray-800 mb-1">
            <i class="fa-solid fa-phone text-emerald-600"></i> Phone Number
          </label>
          <div class="flex flex-col sm:flex-row gap-3">
            <input
              type="text" id="phone" name="phone" required
              inputmode="numeric" pattern="^[6-9]\d{9}$" minlength="10" maxlength="10" autocomplete="tel"
              placeholder="10-digit mobile (India)"
              class="flex-1 rounded-xl border border-gray-200 px-4 py-3 focus:ring-2 focus:ring-emerald-400 outline-none"
            />
            <button type="button"
              class="px-5 py-3 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700 transition"
              onclick="sendOTP()">
              <i class="fa-solid fa-paper-plane"></i> Send OTP
            </button>
          </div>
          <p class="text-xs text-gray-500 mt-1">Your number will be used for login & verification.</p>
        </div>

        <!-- OTP -->
        <div id="otpSection" style="display:none;" class="rounded-2xl bg-indigo-50 border border-indigo-200 p-4">
          <label for="otp" class="flex items-center gap-2 text-sm font-semibold text-gray-800 mb-1">
            <i class="fa-solid fa-key text-indigo-600"></i> Enter OTP
          </label>
          <div class="flex gap-3">
            <input
              type="text" id="otp" name="otp" maxlength="6"
              placeholder="6-digit OTP"
              class="flex-1 rounded-xl border border-gray-200 px-4 py-3 focus:ring-2 focus:ring-indigo-400 outline-none"
            />
            <button id="verifyBtn" type="button"
              class="px-4 py-3 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700 font-semibold"
              onclick="verifyOTP()">Verify</button>
          </div>
          <span id="otpStatus" class="block mt-2 text-sm font-semibold"></span>
          <div id="otpTimer" class="text-xs text-gray-500 mt-1"></div>
          <button id="resendBtn" type="button"
            class="mt-3 px-3 py-2 rounded-lg bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 text-sm font-medium"
            onclick="sendOTP()" disabled>
            Resend OTP
          </button>
        </div>

        <input type="hidden" id="otp_verified" name="otp_verified" value="false" />

        <!-- Address -->
        <div>
          <label for="store_address" class="flex items-center gap-2 text-sm font-semibold text-gray-800 mb-1">
            <i class="fa-solid fa-map-location-dot text-emerald-600"></i> Store Address
          </label>
          <textarea
            id="store_address" name="store_address" required
            placeholder="Full address with area, city, pincode"
            class="w-full rounded-xl border border-gray-200 px-4 py-3 min-h-[96px] focus:ring-2 focus:ring-emerald-400 outline-none"
          ></textarea>
          <p class="text-xs text-gray-500 mt-1">Used for deliveries and customer reference.</p>

          <!-- Location Button -->
          <button type="button"
            onclick="getStoreLocation()"
            class="mt-3 inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-emerald-100 border border-emerald-300 text-emerald-800 hover:bg-emerald-200 font-semibold text-sm">
            <i class="fa-solid fa-location-crosshairs"></i>
            Use Current Location
          </button>

          <p id="locationStatus" class="text-xs mt-2 text-gray-500">
            Location helps customers find your store nearby.
          </p>
        </div>

        <input type="hidden" id="store_lat" name="store_lat">
        <input type="hidden" id="store_lng" name="store_lng">

        <!-- Category -->
        <div>
          <label for="store_category" class="flex items-center gap-2 text-sm font-semibold text-gray-800 mb-1">
            <i class="fa-solid fa-list text-emerald-600"></i> Store Category
          </label>
          <select id="store_category" name="store_category" required
            class="w-full rounded-xl border border-gray-200 px-4 py-3 focus:ring-2 focus:ring-emerald-400 outline-none">
            <option value="">Select Category</option>
            <option value="grocery">Grocery</option>
            <option value="pharmacy">Pharmacy</option>
            <option value="stationery">Stationery</option>
          </select>
        </div>

        <!-- Passwords -->
        <div class="grid sm:grid-cols-2 gap-4">
          <div>
            <label for="password" class="flex items-center gap-2 text-sm font-semibold text-gray-800 mb-1">
              <i class="fa-solid fa-lock text-emerald-600"></i> Password
            </label>
            <div class="relative">
              <input
                type="password" id="password" name="password" required
                placeholder="Create password" autocomplete="new-password"
                class="w-full rounded-xl border border-gray-200 px-4 py-3 pr-11 focus:ring-2 focus:ring-emerald-400 outline-none"
              />
              <button type="button" id="togglePass"
                class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700">
                <i class="fa-regular fa-eye"></i>
              </button>
            </div>
            <div class="h-1.5 bg-gray-200 rounded-full overflow-hidden mt-2">
              <span id="strengthBar" class="block h-full w-0 bg-emerald-500 transition-all"></span>
            </div>
            <div class="mt-2 flex items-center gap-2 text-xs text-gray-500">
              <i class="fa-solid fa-circle-info text-amber-500"></i>
              <span>Use 8+ chars with a mix of letters & numbers.</span>
            </div>
          </div>

          <div>
            <label for="confirm_password" class="flex items-center gap-2 text-sm font-semibold text-gray-800 mb-1">
              <i class="fa-solid fa-lock text-emerald-600"></i> Confirm Password
            </label>
            <div class="relative">
              <input
                type="password" id="confirm_password" name="confirm_password" required
                placeholder="Re-enter password" autocomplete="new-password"
                class="w-full rounded-xl border border-gray-200 px-4 py-3 pr-11 focus:ring-2 focus:ring-emerald-400 outline-none"
              />
              <button type="button" id="togglePass2"
                class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700">
                <i class="fa-regular fa-eye"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Submit -->
        <button type="submit"
          class="w-full py-3.5 rounded-xl bg-gradient-to-r from-emerald-600 to-indigo-600 text-white font-extrabold shadow-lg hover:brightness-95 transition">
          <i class="fa-solid fa-store mr-2"></i> Register Store
        </button>
      </form>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="text-center text-gray-500 text-sm py-6">
    ¬© 2025 SmartDukaan. All rights reserved.
  </footer>

  <!-- JS LOGIC: UNCHANGED -->
  <script>
    let otpTimer;

    function sendOTP() {
      const phone = document.getElementById("phone").value;

      if (!phone.match(/^[6-9]\d{9}$/)) {
        alert("Please enter a valid 10-digit phone number.");
        return;
      }

      const fakeNumbers = ['9999999999', '8888888888', '7777777777'];
      if (fakeNumbers.includes(phone)) {
        alert("Please enter a valid real phone number.");
        return;
      }

      fetch('/send_otp', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ phone: phone })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert("OTP sent successfully!");
          document.getElementById("otpSection").style.display = "block";
          document.getElementById("otp").focus();
          document.getElementById("otp_verified").value = "false";
          document.getElementById("otpStatus").innerText = "";
          document.getElementById("verifyBtn").disabled = false;
          startOTPTimer();
        } else {
          alert("Failed to send OTP. Please try again later.");
        }
      });
    }

    function verifyOTP() {
      const phone = document.getElementById("phone").value;
      const otp = document.getElementById("otp").value;

      if (!otp || otp.length !== 6) {
        alert("Please enter a valid 6-digit OTP.");
        return;
      }

      fetch('/verify_otp', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ phone: phone, otp: otp })
      })
      .then(res => res.json())
      .then(data => {
        if (data.verified) {
          document.getElementById("otpStatus").innerText = "‚úÖ OTP Verified!";
          document.getElementById("otp_verified").value = "true";
          document.getElementById("verifyBtn").disabled = true;
          clearInterval(otpTimer);
          document.getElementById("otpTimer").innerText = "";
          document.getElementById("resendBtn").disabled = true;
        } else {
          document.getElementById("otpStatus").innerText = "‚ùå Invalid OTP!";
          document.getElementById("otp_verified").value = "false";
        }
      });
    }

    function checkFormValidation() {
      const verified = document.getElementById("otp_verified").value;
      const password = document.getElementById("password").value;
      const confirmPassword = document.getElementById("confirm_password").value;
      const lat = document.getElementById("store_lat").value;
      const lng = document.getElementById("store_lng").value;
      
      if (!lat || !lng) {
        alert("Please use 'Current Location' to register your store.");
        return false;
      }
      if (verified !== "true") {
        alert("Please verify your phone number with the OTP before submitting.");
        return false;
      }

      if (password !== confirmPassword) {
        alert("Passwords do not match.");
        return false;
      }

      return true;
    }

    function startOTPTimer() {
      let duration = 120;
      clearInterval(otpTimer);
      document.getElementById("resendBtn").disabled = true;

      otpTimer = setInterval(() => {
        let minutes = Math.floor(duration / 60);
        let seconds = duration % 60;
        document.getElementById("otpTimer").innerText =
          `OTP expires in ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        duration--;

        if (duration < 0) {
          clearInterval(otpTimer);
          document.getElementById("otpTimer").innerText = "‚è∞ OTP expired. Please resend.";
          document.getElementById("verifyBtn").disabled = true;
          document.getElementById("resendBtn").disabled = false;
        }
      }, 1000);
    }

    (function () {
      const pass = document.getElementById('password');
      const pass2 = document.getElementById('confirm_password');
      const t1 = document.getElementById('togglePass');
      const t2 = document.getElementById('togglePass2');
      const bar = document.getElementById('strengthBar');

      const toggle = (input, btn) => {
        const visible = input.type === 'text';
        input.type = visible ? 'password' : 'text';
        btn.innerHTML = visible ? '<i class="fa-regular fa-eye"></i>' : '<i class="fa-regular fa-eye-slash"></i>';
      };
      t1.addEventListener('click', () => toggle(pass, t1));
      t2.addEventListener('click', () => toggle(pass2, t2));

      pass.addEventListener('input', () => {
        const v = pass.value;
        let s = 0;
        if (v.length >= 8) s += 30;
        if (/[A-Z]/.test(v)) s += 20;
        if (/[a-z]/.test(v)) s += 20;
        if (/\d/.test(v)) s += 20;
        if (/[^A-Za-z0-9]/.test(v)) s += 10;
        bar.style.width = Math.min(s, 100) + '%';
      });
    })();

    function getStoreLocation() {
      if (!navigator.geolocation) {
        alert("Geolocation not supported in this browser");
        return;
      }

      const status = document.getElementById("locationStatus");
      status.innerText = "üìç Fetching accurate location...";

      navigator.geolocation.getCurrentPosition(
        function (position) {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          const accuracy = position.coords.accuracy;

          if (accuracy > 100) {
            status.innerText = "‚ö†Ô∏è Location not accurate (" + Math.round(accuracy) + "m). Please move outside and try again.";
            status.classList.remove("text-gray-500");
            status.classList.add("text-red-600");
            return;
          }

          document.getElementById("store_lat").value = lat;
          document.getElementById("store_lng").value = lng;

          status.innerText = "‚úÖ Accurate location captured";
          status.classList.remove("text-gray-500", "text-red-600");
          status.classList.add("text-emerald-600");
        },
        function () {
          alert("Please allow location access to continue");
          status.innerText = "‚ùå Location permission denied";
          status.classList.remove("text-gray-500");
          status.classList.add("text-red-600");
        },
        {
          enableHighAccuracy: true,
          timeout: 15000,
          maximumAge: 0
        }
      );
    }
  </script>
</body>
</html>
